<Configuration name="Example1">

	<jmsRealms>
		<jmsRealm datasourceName="jdbc/${instance.name.lc}" realmName="jdbc"/>
	</jmsRealms>

	<adapter name="01 TestMessageLog" description="Stop adapter 03 and 04, select this adapter (01) at Test a PipeLine and send one or more random messages to start the test. Click the small blue envelope at the sender information of this adapter to see the messages sent by this adapter on the message log page">
		<receiver
			name="TestMessageLogReceiver"
			className="nl.nn.adapterframework.receivers.GenericReceiver"
			>
			<listener
				name="TestMessageLogListener"
				className="nl.nn.adapterframework.receivers.JavaListener"
			/>
		</receiver>
		<pipeline firstPipe="Send">
			<exits>
				<exit path="EXIT" state="success"/>
			</exits>
			<pipe name="Send">
				<sender
					className="nl.nn.adapterframework.senders.IbisLocalSender"
					javaListener="TestMessageStoreSender"
				/>
				<messageLog
					className="nl.nn.adapterframework.jdbc.JdbcTransactionalStorage"
					jmsRealm="jdbc"
					slotId="${instance.name}/TestMessageLog"
				/>
				<forward name="success" path="EXIT"/>
			</pipe>
		</pipeline>
	</adapter>

	<adapter name="02 TestMessageStoreSender" description="Click the small blue envelope at the sender information of this adapter to browse the message store for messages that have not yet been processed. Start adapter 03 to have them processed">
		<receiver
			name="TestMessageStoreSender"
			className="nl.nn.adapterframework.receivers.GenericReceiver"
			>
			<listener
				name="TestMessageStoreSender"
				className="nl.nn.adapterframework.receivers.JavaListener"
			/>
		</receiver>
		<pipeline firstPipe="Send">
			<exits>
				<exit path="EXIT" state="success"/>
			</exits>
			<pipe name="Send">
				<sender
					className="nl.nn.adapterframework.jdbc.MessageStoreSender"
					jmsRealm="jdbc"
					slotId="${instance.name}/TestMessageStore"
					onlyStoreWhenMessageIdUnique="false"
				/>
				<messageLog
					className="nl.nn.adapterframework.jdbc.DummyTransactionalStorage"
					jmsRealm="jdbc"
					slotId="${instance.name}/TestMessageStore"
					type="M"
				/>
				<forward name="success" path="EXIT"/>
			</pipe>
		</pipeline>
	</adapter>

	<adapter name="03 TestMessageStoreListenerAndErrorStorage" description="Click the small white in red cross at the listener information of this adapter to go to the error storage page and see that messages are not processed because of failures. Start adapter 04 and resend them from the error storage page">
		<receiver
			name="TestMessageStoreListenerAndErrorStorage"
			className="nl.nn.adapterframework.receivers.GenericReceiver"
			numThreads="4"
			transactionAttribute="Required"
			pollInterval="1"
			>
			<listener
				name="TestMessageStoreListenerAndErrorStorage"
				className="nl.nn.adapterframework.jdbc.MessageStoreListener"
				jmsRealm="jdbc"
				slotId="${instance.name}/TestMessageStore"
			/>
			<errorStorage
				className="nl.nn.adapterframework.jdbc.JdbcTransactionalStorage"
				jmsRealm="jdbc"
				slotId="${instance.name}/TestErrorStorage"
			/>
		</receiver>
		<pipeline firstPipe="Send">
			<exits>
				<exit path="EXIT" state="success"/>
			</exits>
			<pipe name="Send">
				<sender
					className="nl.nn.adapterframework.senders.IbisLocalSender"
					javaListener="TestFailureAndSuccess"
					dependencyTimeOut="0"
				/>
			</pipe>
		</pipeline>
	</adapter>

	<adapter name="04 TestFailureAndSuccess" description="Stop this adapter to test failure, start it for success">
		<receiver
			name="TestFailureAndSuccess"
			className="nl.nn.adapterframework.receivers.GenericReceiver"
			>
			<listener
				name="TestFailureAndSuccess"
				className="nl.nn.adapterframework.receivers.JavaListener"
			/>
		</receiver>
		<pipeline firstPipe="Echo">
			<exits>
				<exit path="EXIT" state="success"/>
			</exits>
			<pipe
				name="Echo"
				className="nl.nn.adapterframework.pipes.EchoPipe"
				>
				<forward name="success" path="EXIT"/>
			</pipe>
		</pipeline>
	</adapter>

</Configuration>